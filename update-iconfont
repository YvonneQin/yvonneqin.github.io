#!/bin/bash

# ç®€å•çš„iconfontæ›´æ–°å‘½ä»¤
# ä½¿ç”¨æ–¹æ³•: ./update-iconfont [æ–°é“¾æ¥]

if [ $# -eq 0 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: ./update-iconfont [æ–°é“¾æ¥]"
    echo "ç¤ºä¾‹: ./update-iconfont https://at.alicdn.com/t/c/font_4545731_new.css"
    exit 1
fi

NEW_URL="$1"
echo "ğŸ”„ æ­£åœ¨æ›´æ–°iconfonté“¾æ¥åˆ°: $NEW_URL"

# æ›´æ–°æ‰€æœ‰HTMLæ–‡ä»¶
find . -name "*.html" -type f -exec sed -i '' "s|https://at\.alicdn\.com/t/c/font_[^.]*\.css|$NEW_URL|g" {} \;

# æ›´æ–°é…ç½®æ–‡ä»¶
if [ -f "iconfont-config.json" ]; then
    sed -i '' "s|\"url\": \"[^\"]*\"|\"url\": \"$NEW_URL\"|g" iconfont-config.json
    echo "âœ… å·²æ›´æ–° iconfont-config.json"
fi

if [ -f "js/config.js" ]; then
    sed -i '' "s|primary: '[^']*'|primary: '$NEW_URL'|g" js/config.js
    echo "âœ… å·²æ›´æ–° js/config.js"
fi

# ç»Ÿè®¡æ›´æ–°çš„æ–‡ä»¶
UPDATED_COUNT=$(find . -name "*.html" -type f -exec grep -l "at\.alicdn\.com" {} \; | wc -l)

echo "âœ… æ›´æ–°å®Œæˆï¼å…±æ›´æ–°äº† $UPDATED_COUNT ä¸ªæ–‡ä»¶"
echo "ğŸ”— æ–°é“¾æ¥: $NEW_URL"
